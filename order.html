<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è®¢å• - WUWUMALL</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* è®¢å•é¡µé¢ç‰¹å®šæ ·å¼ */
        .orders-page {
            min-height: calc(100vh - 150px);
            padding: 20px 0;
        }

        .page-title {
            text-align: center;
            font-size: 28px;
            color: #333;
            margin-bottom: 30px;
            position: relative;
        }

        .page-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background: #e60012;
            margin: 10px auto;
            border-radius: 2px;
        }

        .order-filter {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #e60012;
            background: white;
            color: #e60012;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: #e60012;
            color: white;
        }

        .orders-list {
            max-width: 1000px;
            margin: 0 auto;
        }

        .order-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .order-info h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #333;
        }

        .order-meta {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }

        .order-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-pending {
            background: #ffc107;
            color: #856404;
        }

        .status-processing {
            background: #17a2b8;
            color: white;
        }

        .status-shipped {
            background: #28a745;
            color: white;
        }

        .status-delivered {
            background: #6c757d;
            color: white;
        }

        .status-cancelled {
            background: #dc3545;
            color: white;
        }

        .order-items {
            padding: 0 20px;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-right: 20px;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .item-quantity {
            color: #666;
            font-size: 14px;
        }

        .item-price {
            font-weight: 600;
            color: #e60012;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }

        .order-total {
            font-size: 18px;
            font-weight: 600;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pay-btn {
            background: #e60012;
            color: white;
            border: none;
        }

        .pay-btn:hover {
            background: #cc0010;
        }

        .cancel-btn {
            background: white;
            color: #666;
            border: 1px solid #ddd;
        }

        .cancel-btn:hover {
            background: #f8f9fa;
        }

        .view-btn {
            background: white;
            color: #007bff;
            border: 1px solid #007bff;
        }

        .view-btn:hover {
            background: #f0f8ff;
        }

        /* ç©ºè®¢å•çŠ¶æ€ */
        .empty-orders {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .empty-icon {
            font-size: 60px;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 24px;
            color: #666;
            margin-bottom: 10px;
        }

        .empty-text {
            color: #999;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .shop-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #e60012;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
        }

        .shop-btn:hover {
            background: #cc0010;
            color: white;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .order-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .order-meta {
                flex-direction: column;
                gap: 5px;
            }

            .order-item {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .item-image {
                margin-right: 0;
            }

            .order-footer {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .order-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav class="navbar">
    <div class="nav-container">
        <div class="nav-left">
            <a href="index.html" class="logo">
                <i class="fas fa-shopping-bag"></i>
                <span>WUWUMALL</span>
            </a>
            <div class="file-path">
                <i class="fas fa-file"></i>
                C:/Users/Administrator/Desktop/wuwumall/order.html
            </div>
        </div>

        <div class="nav-center">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢å•†å“...">
                <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
            </div>
        </div>

        <div class="nav-right">
            <a href="order.html" class="nav-item">
                <i class="fas fa-file-alt"></i>
                <span>æˆ‘çš„è®¢å•</span>
                <span class="badge" id="orderCount">0</span>
            </a>
            <a href="customer.html?tab=cart" class="nav-item">
                <i class="fas fa-shopping-cart"></i>
                <span>è´­ç‰©è½¦</span>
                <span class="badge" id="cartCount">0</span>
            </a>
            <a href="customer.html" class="nav-item">
                <i class="fas fa-user-circle"></i>
                <span>æˆ‘çš„è´¦æˆ·</span>
            </a>
            <div class="time-display">
                <div class="temp">7â„ƒ</div>
                <div class="time" id="currentTime">19:43</div>
                <div class="date" id="currentDate">2025/12/24</div>
            </div>
        </div>
    </div>
</nav>

<!-- è®¢å•é¡µé¢å†…å®¹ -->
<div class="container orders-page">
    <h1 class="page-title">æˆ‘çš„è®¢å•</h1>

    <div class="order-filter">
        <button class="filter-btn active" data-status="all">å…¨éƒ¨è®¢å•</button>
        <button class="filter-btn" data-status="pending">å¾…ä»˜æ¬¾</button>
        <button class="filter-btn" data-status="processing">å¤„ç†ä¸­</button>
        <button class="filter-btn" data-status="shipped">å·²å‘è´§</button>
        <button class="filter-btn" data-status="delivered">å·²å®Œæˆ</button>
    </div>

    <div class="orders-list" id="ordersList">
        <!-- è®¢å•å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>

<script src="js/db.js"></script>
<script>
    // è®¢å•æ•°æ®ç¤ºä¾‹
    const sampleOrders = [
        {
            id: 'ORD202512240001',
            userId: 'user_001',
            items: [
                { id: 1, name: 'åä¸ºMate 60 Pro', price: 6999, quantity: 1, image: 'ğŸ“±' },
                { id: 7, name: 'JavaScriptæƒå¨æŒ‡å—', price: 129, quantity: 2, image: 'ğŸ“˜' }
            ],
            total: 6999 + (129 * 2),
            status: 'pending',
            createTime: '2025-12-24 10:30:00',
            address: 'åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·',
            receiver: 'å¼ å…ˆç”Ÿ',
            phone: '13800138000'
        },
        {
            id: 'ORD202512230002',
            userId: 'user_001',
            items: [
                { id: 4, name: 'è€å…‹è¿åŠ¨é‹', price: 699, quantity: 1, image: 'ğŸ‘Ÿ' },
                { id: 8, name: 'è¿›å£å’–å•¡è±†', price: 89, quantity: 3, image: 'â˜•' }
            ],
            total: 699 + (89 * 3),
            status: 'shipped',
            createTime: '2025-12-23 15:20:00',
            address: 'åŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHO',
            receiver: 'æå¥³å£«',
            phone: '13900139000',
            trackingNumber: 'SF1234567890'
        },
        {
            id: 'ORD202512220003',
            userId: 'user_001',
            items: [
                { id: 5, name: 'æ™ºèƒ½æ‰«åœ°æœºå™¨äºº', price: 2999, quantity: 1, image: 'ğŸ¤–' }
            ],
            total: 2999,
            status: 'delivered',
            createTime: '2025-12-22 09:15:00',
            address: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºé™†å®¶å˜´',
            receiver: 'ç‹å…ˆç”Ÿ',
            phone: '13700137000',
            deliveredTime: '2025-12-24 16:00:00'
        }
    ];

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            updateTime();
            setInterval(updateTime, 1000);

            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
            if (!currentUser) {
                showLoginMessage();
                return;
            }

            // åŠ è½½è®¢å•
            await loadOrders();

            // åˆå§‹åŒ–ç­›é€‰æŒ‰é’®
            setupFilterButtons();

            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
            initSearch();

            // æ›´æ–°è´­ç‰©è½¦è®¡æ•°
            updateCartCount();

            console.log('è®¢å•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        } catch (error) {
            console.error('è®¢å•é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
        }
    });

    // æ›´æ–°æ—¶é—´æ˜¾ç¤º
    function updateTime() {
        const now = new Date();
        const timeEl = document.getElementById('currentTime');
        const dateEl = document.getElementById('currentDate');

        if (timeEl) {
            timeEl.textContent = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
        }

        if (dateEl) {
            dateEl.textContent = now.toLocaleDateString('zh-CN');
        }
    }

    // åŠ è½½è®¢å•
    async function loadOrders(status = 'all') {
        try {
            const db = await getDB();
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');

            let orders = [];

            if (currentUser) {
                // ä»æ•°æ®åº“åŠ è½½è®¢å•
                orders = await db.query('orders', 'userId', currentUser.id);

                // å¦‚æœæ•°æ®åº“ä¸ºç©ºï¼Œä½¿ç”¨ç¤ºä¾‹æ•°æ®
                if (orders.length === 0) {
                    orders = sampleOrders;
                }
            } else {
                // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
                orders = sampleOrders;
            }

            // ç­›é€‰è®¢å•çŠ¶æ€
            if (status !== 'all') {
                orders = orders.filter(order => order.status === status);
            }

            // æŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            orders.sort((a, b) => new Date(b.createTime) - new Date(a.createTime));

            displayOrders(orders);

        } catch (error) {
            console.error('åŠ è½½è®¢å•å¤±è´¥:', error);
            // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
            displayOrders(sampleOrders);
        }
    }

    // æ˜¾ç¤ºè®¢å•
    function displayOrders(orders) {
        const ordersList = document.getElementById('ordersList');

        if (orders.length === 0) {
            ordersList.innerHTML = `
        <div class="empty-orders">
          <i class="fas fa-box-open empty-icon"></i>
          <h2 class="empty-title">æš‚æ— è®¢å•</h2>
          <p class="empty-text">æ‚¨è¿˜æ²¡æœ‰è®¢å•ï¼Œå¿«å»æŒ‘é€‰å–œæ¬¢çš„å•†å“å§ï¼</p>
          <a href="index.html" class="shop-btn">
            <i class="fas fa-shopping-bag"></i>
            å»è´­ç‰©
          </a>
        </div>
      `;
            return;
        }

        ordersList.innerHTML = orders.map(order => `
      <div class="order-card" data-order-id="${order.id}">
        <div class="order-header">
          <div class="order-info">
            <h3>è®¢å•å·: ${order.id}</h3>
            <div class="order-meta">
              <span>ä¸‹å•æ—¶é—´: ${order.createTime}</span>
              <span>æ”¶è´§äºº: ${order.receiver}</span>
              <span>ç”µè¯: ${order.phone}</span>
            </div>
          </div>
          <div class="order-status ${getStatusClass(order.status)}">
            ${getStatusText(order.status)}
          </div>
        </div>

        <div class="order-items">
          ${order.items.map(item => `
            <div class="order-item">
              <div class="item-image">${item.image}</div>
              <div class="item-details">
                <div class="item-name">${item.name}</div>
                <div class="item-quantity">æ•°é‡: ${item.quantity}</div>
              </div>
              <div class="item-price">Â¥${item.price.toFixed(2)}</div>
            </div>
          `).join('')}
        </div>

        <div class="order-footer">
          <div class="order-total">
            åˆè®¡: <span style="color:#e60012; font-size:20px;">Â¥${order.total.toFixed(2)}</span>
          </div>
          <div class="order-actions">
            ${getOrderActions(order.status, order.id)}
          </div>
        </div>
      </div>
    `).join('');

        // æ›´æ–°è®¢å•æ•°é‡
        updateOrderCount(orders.length);
    }

    // è·å–çŠ¶æ€æ ·å¼ç±»
    function getStatusClass(status) {
        const statusClasses = {
            'pending': 'status-pending',
            'processing': 'status-processing',
            'shipped': 'status-shipped',
            'delivered': 'status-delivered',
            'cancelled': 'status-cancelled'
        };
        return statusClasses[status] || 'status-pending';
    }

    // è·å–çŠ¶æ€æ–‡æœ¬
    function getStatusText(status) {
        const statusTexts = {
            'pending': 'å¾…ä»˜æ¬¾',
            'processing': 'å¤„ç†ä¸­',
            'shipped': 'å·²å‘è´§',
            'delivered': 'å·²å®Œæˆ',
            'cancelled': 'å·²å–æ¶ˆ'
        };
        return statusTexts[status] || 'æœªçŸ¥çŠ¶æ€';
    }

    // è·å–è®¢å•æ“ä½œæŒ‰é’®
    function getOrderActions(status, orderId) {
        let actions = '';

        switch(status) {
            case 'pending':
                actions = `
          <button class="action-btn pay-btn" onclick="payOrder('${orderId}')">ç«‹å³ä»˜æ¬¾</button>
          <button class="action-btn cancel-btn" onclick="cancelOrder('${orderId}')">å–æ¶ˆè®¢å•</button>
        `;
                break;

            case 'processing':
                actions = `
          <button class="action-btn view-btn" onclick="viewOrder('${orderId}')">æŸ¥çœ‹è¯¦æƒ…</button>
        `;
                break;

            case 'shipped':
                actions = `
          <button class="action-btn view-btn" onclick="confirmReceipt('${orderId}')">ç¡®è®¤æ”¶è´§</button>
          <button class="action-btn view-btn" onclick="viewOrder('${orderId}')">æŸ¥çœ‹ç‰©æµ</button>
        `;
                break;

            case 'delivered':
                actions = `
          <button class="action-btn view-btn" onclick="viewOrder('${orderId}')">æŸ¥çœ‹è®¢å•</button>
          <button class="action-btn view-btn" onclick="applyAfterSale('${orderId}')">ç”³è¯·å”®å</button>
        `;
                break;

            default:
                actions = `
          <button class="action-btn view-btn" onclick="viewOrder('${orderId}')">æŸ¥çœ‹è¯¦æƒ…</button>
        `;
        }

        return actions;
    }

    // è®¢å•æ“ä½œå‡½æ•°
    function payOrder(orderId) {
        alert(`æ”¯ä»˜è®¢å•: ${orderId}`);
        // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè·³è½¬åˆ°æ”¯ä»˜é¡µé¢
    }

    function cancelOrder(orderId) {
        if (confirm('ç¡®å®šè¦å–æ¶ˆæ­¤è®¢å•å—ï¼Ÿ')) {
            alert(`å–æ¶ˆè®¢å•: ${orderId}`);
            // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ›´æ–°è®¢å•çŠ¶æ€
        }
    }

    function viewOrder(orderId) {
        alert(`æŸ¥çœ‹è®¢å•è¯¦æƒ…: ${orderId}`);
        // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè·³è½¬åˆ°è®¢å•è¯¦æƒ…é¡µ
    }

    function confirmReceipt(orderId) {
        if (confirm('ç¡®è®¤æ”¶åˆ°å•†å“äº†å—ï¼Ÿ')) {
            alert(`ç¡®è®¤æ”¶è´§: ${orderId}`);
            // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ
        }
    }

    function applyAfterSale(orderId) {
        alert(`ç”³è¯·å”®å: ${orderId}`);
        // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè·³è½¬åˆ°å”®åç”³è¯·é¡µé¢
    }

    // åˆå§‹åŒ–ç­›é€‰æŒ‰é’®
    function setupFilterButtons() {
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰activeç±»
                filterButtons.forEach(btn => btn.classList.remove('active'));
                // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                this.classList.add('active');

                // ç­›é€‰è®¢å•
                const status = this.getAttribute('data-status');
                loadOrders(status);
            });
        });
    }

    // æ˜¾ç¤ºç™»å½•æç¤º
    function showLoginMessage() {
        const ordersList = document.getElementById('ordersList');
        ordersList.innerHTML = `
      <div class="empty-orders">
        <i class="fas fa-user-lock empty-icon"></i>
        <h2 class="empty-title">è¯·å…ˆç™»å½•</h2>
        <p class="empty-text">ç™»å½•åæŸ¥çœ‹æ‚¨çš„è®¢å•</p>
        <a href="login.html" class="shop-btn">
          <i class="fas fa-sign-in-alt"></i>
          ç«‹å³ç™»å½•
        </a>
      </div>
    `;
    }

    // æ›´æ–°è®¢å•æ•°é‡
    function updateOrderCount(count) {
        const orderCount = document.getElementById('orderCount');
        if (orderCount) {
            orderCount.textContent = count;
        }
    }

    // æ›´æ–°è´­ç‰©è½¦è®¡æ•°
    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('wuwumall_cart') || '[]');
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

        const cartCount = document.getElementById('cartCount');
        if (cartCount) {
            cartCount.textContent = totalItems;
        }
    }

    // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
    function initSearch() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProducts();
                }
            });
        }
    }

    // æœç´¢å•†å“
    function searchProducts() {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            const keyword = searchInput.value.trim();
            if (keyword) {
                window.location.href = `customer.html?search=${encodeURIComponent(keyword)}`;
            }
        }
    }
</script>
</body>
</html>