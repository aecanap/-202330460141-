<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»“ç®—ä¸­å¿ƒ - WUWUMALL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --jd-red: #e33333;
            --jd-red-dark: #c41f1f;
            --jd-red-light: #fef0f0;
            --jd-gray: #f5f5f5;
            --jd-gray-dark: #e0e0e0;
            --jd-text: #333;
            --jd-text-light: #666;
            --jd-text-lighter: #999;
            --jd-border: #e8e8e8;
            --jd-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --jd-radius: 4px;
            --jd-success: #27ae60;
            --jd-warning: #f39c12;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
        }

        body {
            background-color: var(--jd-gray);
            color: var(--jd-text);
            line-height: 1.5;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            background-color: var(--jd-red);
            color: white;
            padding: 12px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 22px;
            font-weight: bold;
        }

        .logo i {
            margin-right: 8px;
            font-size: 24px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: var(--jd-radius);
            transition: background 0.3s;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ä¸»å®¹å™¨ */
        .checkout-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* è¿›åº¦æ¡ */
        .checkout-progress {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-steps {
            display: flex;
            align-items: center;
            gap: 100px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--jd-gray-dark);
            color: var(--jd-text-lighter);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .step-number.active {
            background: var(--jd-red);
            color: white;
        }

        .step-number.completed {
            background: var(--jd-success);
            color: white;
        }

        .step-text {
            font-size: 14px;
            color: var(--jd-text-light);
        }

        .step-text.active {
            color: var(--jd-red);
            font-weight: bold;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 100px;
            right: 100px;
            height: 2px;
            background: var(--jd-gray-dark);
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background: var(--jd-success);
            width: 0%;
            transition: width 0.3s;
        }

        /* ç»“ç®—å†…å®¹ */
        .checkout-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        /* ç»“ç®—å¡ç‰‡ */
        .checkout-card {
            background: white;
            border-radius: var(--jd-radius);
            box-shadow: var(--jd-shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--jd-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 18px;
            color: var(--jd-text);
        }

        .card-body {
            padding: 20px;
        }

        /* åœ°å€é€‰æ‹© */
        .address-list {
            display: grid;
            gap: 15px;
        }

        .address-item {
            border: 2px solid var(--jd-border);
            border-radius: var(--jd-radius);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .address-item:hover {
            border-color: var(--jd-red-light);
        }

        .address-item.selected {
            border-color: var(--jd-red);
            background: var(--jd-red-light);
        }

        .address-info {
            margin-bottom: 10px;
        }

        .address-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .address-detail {
            color: var(--jd-text-light);
            line-height: 1.4;
        }

        .address-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: var(--jd-radius);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--jd-border);
            color: var(--jd-text-light);
        }

        .btn-outline:hover {
            border-color: var(--jd-red);
            color: var(--jd-red);
        }

        /* æ”¯ä»˜æ–¹å¼ */
        .payment-methods {
            display: grid;
            gap: 10px;
        }

        .payment-method {
            border: 2px solid var(--jd-border);
            border-radius: var(--jd-radius);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .payment-method:hover {
            border-color: var(--jd-red-light);
        }

        .payment-method.selected {
            border-color: var(--jd-red);
            background: var(--jd-red-light);
        }

        .payment-icon {
            width: 40px;
            height: 40px;
            background: var(--jd-gray);
            border-radius: var(--jd-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .payment-info {
            flex: 1;
        }

        .payment-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .payment-desc {
            color: var(--jd-text-light);
            font-size: 12px;
        }

        /* è®¢å•å•†å“ */
        .order-items {
            display: grid;
            gap: 15px;
        }

        .order-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--jd-border);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 60px;
            height: 60px;
            background: var(--jd-gray);
            border-radius: var(--jd-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-price {
            color: var(--jd-red);
            font-weight: bold;
        }

        .item-quantity {
            color: var(--jd-text-light);
        }

        /* è®¢å•æ‘˜è¦ */
        .order-summary {
            position: sticky;
            top: 100px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--jd-border);
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-total {
            font-size: 18px;
            font-weight: bold;
            color: var(--jd-red);
        }

        .coupon-section {
            margin: 20px 0;
            padding: 15px;
            background: var(--jd-gray);
            border-radius: var(--jd-radius);
        }

        .coupon-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .coupon-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--jd-border);
            border-radius: var(--jd-radius;
        }

        .btn-primary {
            background: var(--jd-red);
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: var(--jd-radius);
            cursor: pointer;
            font-weight: bold;
        }

        .btn-primary:hover {
            background: var(--jd-red-dark);
        }

        .btn-large {
            padding: 15px;
            font-size: 16px;
            width: 100%;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--jd-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--jd-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--jd-border);
            border-radius: var(--jd-radius);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn-secondary {
            background: var(--jd-gray-dark);
            color: var(--jd-text);
        }

        .btn-secondary:hover {
            background: #ccc;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .checkout-content {
                grid-template-columns: 1fr;
            }

            .progress-steps {
                gap: 50px;
            }

            .progress-line {
                left: 50px;
                right: 50px;
            }
        }

        /* æˆåŠŸé¡µé¢ */
        .success-page {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: var(--jd-radius);
            box-shadow: var(--jd-shadow);
        }

        .success-icon {
            font-size: 80px;
            color: var(--jd-success);
            margin-bottom: 20px;
        }

        .success-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--jd-success);
        }

        .order-info-card {
            background: var(--jd-gray);
            border-radius: var(--jd-radius);
            padding: 20px;
            margin: 30px 0;
            text-align: left;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="logo">
            <i class="fas fa-shopping-bag"></i>
            <span>WUWUMALL</span>
        </a>
        <div class="nav-right">
            <a href="customer.html" class="nav-item">
                <i class="fas fa-arrow-left"></i>
                <span>è¿”å›é¡¾å®¢ä¸­å¿ƒ</span>
            </a>
        </div>
    </div>
</nav>

<!-- ç»“ç®—å®¹å™¨ -->
<div class="checkout-container">
    <!-- è¿›åº¦æ¡ -->
    <div class="checkout-progress">
        <div class="progress-line">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-steps">
            <div class="progress-step">
                <div class="step-number active" id="step1">1</div>
                <div class="step-text active">ç¡®è®¤è®¢å•</div>
            </div>
            <div class="progress-step">
                <div class="step-number" id="step2">2</div>
                <div class="step-text">æ”¯ä»˜è®¢å•</div>
            </div>
            <div class="progress-step">
                <div class="step-number" id="step3">3</div>
                <div class="step-text">å®Œæˆ</div>
            </div>
        </div>
    </div>

    <!-- ç»“ç®—å†…å®¹ -->
    <div class="checkout-content" id="checkoutContent">
        <!-- å·¦ä¾§ï¼šè®¢å•ä¿¡æ¯ -->
        <div class="checkout-left">
            <!-- æ”¶è´§åœ°å€ -->
            <div class="checkout-card">
                <div class="card-header">
                    <h2><i class="fas fa-map-marker-alt"></i> æ”¶è´§åœ°å€</h2>
                    <button class="btn btn-outline" onclick="showAddressModal()">ç®¡ç†åœ°å€</button>
                </div>
                <div class="card-body">
                    <div class="address-list" id="addressList">
                        <!-- åœ°å€å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- æ”¯ä»˜æ–¹å¼ -->
            <div class="checkout-card">
                <div class="card-header">
                    <h2><i class="fas fa-credit-card"></i> æ”¯ä»˜æ–¹å¼</h2>
                </div>
                <div class="card-body">
                    <div class="payment-methods" id="paymentMethods">
                        <div class="payment-method" data-method="alipay" onclick="selectPayment('alipay')">
                            <div class="payment-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="payment-info">
                                <div class="payment-name">æ”¯ä»˜å®æ”¯ä»˜</div>
                                <div class="payment-desc">æ•°äº¿ç”¨æˆ·éƒ½åœ¨ç”¨ï¼Œå®‰å…¨å¯æ‰˜ä»˜</div>
                            </div>
                        </div>
                        <div class="payment-method" data-method="wechat" onclick="selectPayment('wechat')">
                            <div class="payment-icon">
                                <i class="fab fa-weixin"></i>
                            </div>
                            <div class="payment-info">
                                <div class="payment-name">å¾®ä¿¡æ”¯ä»˜</div>
                                <div class="payment-desc">å¾®ä¿¡ç”¨æˆ·ä¼˜é€‰ï¼Œå¿«æ·å®‰å…¨</div>
                            </div>
                        </div>
                        <div class="payment-method" data-method="bank" onclick="selectPayment('bank')">
                            <div class="payment-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="payment-info">
                                <div class="payment-name">é“¶è¡Œå¡æ”¯ä»˜</div>
                                <div class="payment-desc">æ”¯æŒå‚¨è“„å¡/ä¿¡ç”¨å¡</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å•†å“æ¸…å• -->
            <div class="checkout-card">
                <div class="card-header">
                    <h2><i class="fas fa-box"></i> å•†å“æ¸…å•</h2>
                </div>
                <div class="card-body">
                    <div class="order-items" id="orderItems">
                        <!-- å•†å“å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šè®¢å•æ‘˜è¦ -->
        <div class="checkout-right">
            <div class="checkout-card order-summary">
                <div class="card-header">
                    <h2>è®¢å•æ‘˜è¦</h2>
                </div>
                <div class="card-body">
                    <div class="summary-row">
                        <span>å•†å“é‡‘é¢</span>
                        <span id="subtotal">Â¥0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>è¿è´¹</span>
                        <span id="shippingFee">Â¥0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>ä¼˜æƒ åˆ¸</span>
                        <span id="couponDiscount">-Â¥0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>æ´»åŠ¨ä¼˜æƒ </span>
                        <span id="promotionDiscount">-Â¥0.00</span>
                    </div>
                    <div class="summary-row summary-total">
                        <span>åº”ä»˜æ€»é¢</span>
                        <span id="totalAmount">Â¥0.00</span>
                    </div>

                    <div class="coupon-section">
                        <div>ä½¿ç”¨ä¼˜æƒ åˆ¸</div>
                        <div class="coupon-input">
                            <input type="text" id="couponCode" placeholder="è¾“å…¥ä¼˜æƒ ç ">
                            <button class="btn-primary" onclick="applyCoupon()">ä½¿ç”¨</button>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-large" onclick="submitOrder()">
                        <i class="fas fa-lock"></i> æäº¤è®¢å•
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸé¡µé¢ï¼ˆåˆå§‹éšè—ï¼‰ -->
    <div class="success-page" id="successPage" style="display: none;">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h1 class="success-title">è®¢å•æäº¤æˆåŠŸï¼</h1>
        <p>æ„Ÿè°¢æ‚¨çš„è´­ä¹°ï¼Œè®¢å•æ­£åœ¨å¤„ç†ä¸­</p>

        <div class="order-info-card">
            <div class="info-row">
                <span>è®¢å•å·ï¼š</span>
                <span id="successOrderNo">ORD202312240001</span>
            </div>
            <div class="info-row">
                <span>åº”ä»˜é‡‘é¢ï¼š</span>
                <span id="successAmount">Â¥0.00</span>
            </div>
            <div class="info-row">
                <span>æ”¶è´§äººï¼š</span>
                <span id="successReceiver">å¼ å…ˆç”Ÿ</span>
            </div>
            <div class="info-row">
                <span>è”ç³»ç”µè¯ï¼š</span>
                <span id="successPhone">138****1234</span>
            </div>
            <div class="info-row">
                <span>æ”¶è´§åœ°å€ï¼š</span>
                <span id="successAddress">åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·</span>
            </div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: center;">
            <button class="btn btn-primary" onclick="viewOrder()">
                <i class="fas fa-file-invoice"></i> æŸ¥çœ‹è®¢å•
            </button>
            <button class="btn btn-outline" onclick="continueShopping()">
                <i class="fas fa-shopping-bag"></i> ç»§ç»­è´­ç‰©
            </button>
        </div>
    </div>
</div>

<!-- åœ°å€ç®¡ç†æ¨¡æ€æ¡† -->
<div class="modal" id="addressModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ç®¡ç†æ”¶è´§åœ°å€</h3>
            <button class="close-modal" onclick="closeAddressModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>æ”¶è´§äºº</label>
                <input type="text" id="addressName" placeholder="è¯·è¾“å…¥æ”¶è´§äººå§“å">
            </div>
            <div class="form-group">
                <label>æ‰‹æœºå·</label>
                <input type="tel" id="addressPhone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
            </div>
            <div class="form-group">
                <label>åœ°åŒº</label>
                <div style="display: flex; gap: 10px;">
                    <select id="province">
                        <option>è¯·é€‰æ‹©çœä»½</option>
                    </select>
                    <select id="city">
                        <option>è¯·é€‰æ‹©åŸå¸‚</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†åœ°å€</label>
                <textarea id="addressDetail" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€" rows="3"></textarea>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeAddressModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveAddress()">ä¿å­˜åœ°å€</button>
            </div>
        </div>
    </div>
</div>

<script>
    // è®¢å•æ•°æ®
    let orderData = {
        items: [],
        address: null,
        paymentMethod: null,
        coupon: null,
        subtotal: 0,
        shipping: 0,
        discount: 0,
        total: 0
    };

    // åœ°å€æ•°æ®
    let addresses = [];
    let selectedAddressId = null;

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
        loadOrderData();
        loadAddresses();
        renderOrderItems();
        updateOrderSummary();
        updateProgress(1);
    });

    // ä»è´­ç‰©è½¦åŠ è½½è®¢å•æ•°æ®
    function loadOrderData() {
        try {
            // ä»localStorageè·å–è´­ç‰©è½¦æ•°æ®
            const cart = JSON.parse(localStorage.getItem('wuwumall_cart') || '[]');

            if (cart.length === 0) {
                // å¦‚æœæ²¡æœ‰è´­ç‰©è½¦æ•°æ®ï¼Œä½¿ç”¨ç¤ºä¾‹æ•°æ®
                orderData.items = [
                    {
                        id: 1,
                        name: "åä¸ºMate 60 Pro",
                        price: 6999,
                        quantity: 1,
                        image: "ğŸ“±"
                    },
                    {
                        id: 2,
                        name: "è€å…‹è¿åŠ¨é‹",
                        price: 699,
                        quantity: 2,
                        image: "ğŸ‘Ÿ"
                    }
                ];
            } else {
                orderData.items = cart;
            }

            // è®¡ç®—å°è®¡
            orderData.subtotal = orderData.items.reduce((total, item) => {
                return total + (item.price * item.quantity);
            }, 0);

            // è®¾ç½®è¿è´¹ï¼ˆæ»¡99åŒ…é‚®ï¼‰
            orderData.shipping = orderData.subtotal >= 99 ? 0 : 10;

            // è®¡ç®—æ€»è®¡
            orderData.total = orderData.subtotal + orderData.shipping - orderData.discount;

        } catch (error) {
            console.error('åŠ è½½è®¢å•æ•°æ®å¤±è´¥:', error);
            // ä½¿ç”¨é»˜è®¤æ•°æ®
            orderData.items = [
                {
                    id: 1,
                    name: "ç¤ºä¾‹å•†å“",
                    price: 999,
                    quantity: 1,
                    image: "ğŸ“¦"
                }
            ];
            orderData.subtotal = 999;
            orderData.shipping = 10;
            orderData.total = 1009;
        }
    }

    // åŠ è½½åœ°å€æ•°æ®
    function loadAddresses() {
        // ä»localStorageè·å–åœ°å€æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤åœ°å€
        const savedAddresses = JSON.parse(localStorage.getItem('wuwumall_addresses') || '[]');

        if (savedAddresses.length === 0) {
            addresses = [
                {
                    id: 1,
                    name: "å¼ å…ˆç”Ÿ",
                    phone: "138****1234",
                    province: "åŒ—äº¬å¸‚",
                    city: "åŒ—äº¬å¸‚",
                    detail: "æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·",
                    isDefault: true
                },
                {
                    id: 2,
                    name: "æå¥³å£«",
                    phone: "139****5678",
                    province: "ä¸Šæµ·å¸‚",
                    city: "ä¸Šæµ·å¸‚",
                    detail: "æµ¦ä¸œæ–°åŒºé™†å®¶å˜´é‡‘èä¸­å¿ƒ",
                    isDefault: false
                }
            ];
            localStorage.setItem('wuwumall_addresses', JSON.stringify(addresses));
        } else {
            addresses = savedAddresses;
        }

        // è®¾ç½®é»˜è®¤åœ°å€
        const defaultAddress = addresses.find(addr => addr.isDefault) || addresses[0];
        if (defaultAddress) {
            selectAddress(defaultAddress.id);
        }

        renderAddresses();
    }

    // æ¸²æŸ“åœ°å€åˆ—è¡¨
    function renderAddresses() {
        const addressList = document.getElementById('addressList');
        addressList.innerHTML = addresses.map(address => `
            <div class="address-item ${selectedAddressId === address.id ? 'selected' : ''}"
                 onclick="selectAddress(${address.id})">
                <div class="address-info">
                    <div class="address-name">
                        ${address.name} ${address.phone}
                        ${address.isDefault ? '<span style="color: var(--jd-red); margin-left: 10px;">é»˜è®¤</span>' : ''}
                    </div>
                    <div class="address-detail">
                        ${address.province} ${address.city} ${address.detail}
                    </div>
                </div>
                <div class="address-actions">
                    ${!address.isDefault ?
            `<button class="btn btn-outline" onclick="setDefaultAddress(${address.id})">è®¾ä¸ºé»˜è®¤</button>` : ''}
                    <button class="btn btn-outline" onclick="editAddress(${address.id})">ç¼–è¾‘</button>
                </div>
            </div>
        `).join('');

        // æ·»åŠ æ–°åœ°å€æŒ‰é’®
        addressList.innerHTML += `
            <div class="address-item" style="text-align: center; cursor: pointer;" onclick="showAddressModal()">
                <i class="fas fa-plus" style="font-size: 24px; color: var(--jd-text-lighter); margin-bottom: 10px;"></i>
                <div>æ·»åŠ æ–°åœ°å€</div>
            </div>
        `;
    }

    // é€‰æ‹©åœ°å€
    function selectAddress(addressId) {
        selectedAddressId = addressId;
        orderData.address = addresses.find(addr => addr.id === addressId);
        renderAddresses();
    }

    // è®¾ç½®é»˜è®¤åœ°å€
    function setDefaultAddress(addressId) {
        addresses.forEach(addr => {
            addr.isDefault = addr.id === addressId;
        });
        localStorage.setItem('wuwumall_addresses', JSON.stringify(addresses));
        renderAddresses();
    }

    // é€‰æ‹©æ”¯ä»˜æ–¹å¼
    function selectPayment(method) {
        orderData.paymentMethod = method;

        // æ›´æ–°UI
        document.querySelectorAll('.payment-method').forEach(el => {
            el.classList.remove('selected');
        });
        document.querySelector(`.payment-method[data-method="${method}"]`).classList.add('selected');
    }

    // æ¸²æŸ“è®¢å•å•†å“
    function renderOrderItems() {
        const orderItems = document.getElementById('orderItems');
        orderItems.innerHTML = orderData.items.map(item => `
            <div class="order-item">
                <div class="item-image">${item.image}</div>
                <div class="item-info">
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">Â¥${item.price.toLocaleString()}</div>
                </div>
                <div class="item-quantity">Ã—${item.quantity}</div>
            </div>
        `).join('');
    }

    // æ›´æ–°è®¢å•æ‘˜è¦
    function updateOrderSummary() {
        document.getElementById('subtotal').textContent = `Â¥${orderData.subtotal.toLocaleString()}`;
        document.getElementById('shippingFee').textContent = `Â¥${orderData.shipping.toLocaleString()}`;
        document.getElementById('couponDiscount').textContent = `-Â¥${orderData.discount.toLocaleString()}`;
        document.getElementById('totalAmount').textContent = `Â¥${orderData.total.toLocaleString()}`;
    }

    // åº”ç”¨ä¼˜æƒ åˆ¸
    function applyCoupon() {
        const couponCode = document.getElementById('couponCode').value.trim();

        if (!couponCode) {
            alert('è¯·è¾“å…¥ä¼˜æƒ ç ');
            return;
        }

        // æ¨¡æ‹Ÿä¼˜æƒ åˆ¸éªŒè¯
        const coupons = {
            'WUWU100': 100,
            'WUWU50': 50,
            'FIRSTORDER': 30
        };

        if (coupons[couponCode]) {
            orderData.discount = coupons[couponCode];
            orderData.coupon = couponCode;
            orderData.total = orderData.subtotal + orderData.shipping - orderData.discount;
            updateOrderSummary();
            alert(`ä¼˜æƒ åˆ¸å·²åº”ç”¨ï¼Œå‡å…Â¥${coupons[couponCode]}`);
        } else {
            alert('ä¼˜æƒ ç æ— æ•ˆæˆ–å·²è¿‡æœŸ');
        }
    }

    // æäº¤è®¢å•
    function submitOrder() {
        // éªŒè¯è¡¨å•
        if (!orderData.address) {
            alert('è¯·é€‰æ‹©æ”¶è´§åœ°å€');
            return;
        }

        if (!orderData.paymentMethod) {
            alert('è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼');
            return;
        }

        // æ˜¾ç¤ºæ”¯ä»˜é¡µé¢
        updateProgress(2);

        // æ¨¡æ‹Ÿæ”¯ä»˜è¿‡ç¨‹
        setTimeout(() => {
            completeOrder();
        }, 2000);
    }

    // å®Œæˆè®¢å•
    function completeOrder() {
        // ç”Ÿæˆè®¢å•å·
        const orderNo = 'ORD' + new Date().getTime();

        // ä¿å­˜è®¢å•åˆ°localStorage
        const order = {
            id: orderNo,
            items: orderData.items,
            address: orderData.address,
            paymentMethod: orderData.paymentMethod,
            total: orderData.total,
            status: 'paid',
            createdAt: new Date().toISOString()
        };

        // ä¿å­˜åˆ°è®¢å•å†å²
        const orders = JSON.parse(localStorage.getItem('wuwumall_orders') || '[]');
        orders.unshift(order);
        localStorage.setItem('wuwumall_orders', JSON.stringify(orders));

        // æ¸…ç©ºè´­ç‰©è½¦
        localStorage.removeItem('wuwumall_cart');

        // æ˜¾ç¤ºæˆåŠŸé¡µé¢
        updateProgress(3);
        showSuccessPage(order);
    }

    // æ˜¾ç¤ºæˆåŠŸé¡µé¢
    function showSuccessPage(order) {
        document.getElementById('checkoutContent').style.display = 'none';
        document.getElementById('successPage').style.display = 'block';

        // å¡«å……è®¢å•ä¿¡æ¯
        document.getElementById('successOrderNo').textContent = order.id;
        document.getElementById('successAmount').textContent = `Â¥${order.total.toLocaleString()}`;
        document.getElementById('successReceiver').textContent = order.address.name;
        document.getElementById('successPhone').textContent = order.address.phone;
        document.getElementById('successAddress').textContent =
            `${order.address.province} ${order.address.city} ${order.address.detail}`;
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress(step) {
        // æ›´æ–°æ­¥éª¤çŠ¶æ€
        for (let i = 1; i <= 3; i++) {
            const stepEl = document.getElementById(`step${i}`);
            const textEl = stepEl.parentElement.querySelector('.step-text');

            if (i < step) {
                stepEl.className = 'step-number completed';
                textEl.className = 'step-text';
            } else if (i === step) {
                stepEl.className = 'step-number active';
                textEl.className = 'step-text active';
            } else {
                stepEl.className = 'step-number';
                textEl.className = 'step-text';
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        const progressFill = document.getElementById('progressFill');
        progressFill.style.width = `${(step - 1) * 50}%`;
    }

    // åœ°å€ç®¡ç†æ¨¡æ€æ¡†
    function showAddressModal() {
        document.getElementById('addressModal').classList.add('active');
    }

    function closeAddressModal() {
        document.getElementById('addressModal').classList.remove('active');
    }

    function saveAddress() {
        const name = document.getElementById('addressName').value;
        const phone = document.getElementById('addressPhone').value;
        const province = document.getElementById('province').value;
        const city = document.getElementById('city').value;
        const detail = document.getElementById('addressDetail').value;

        if (!name || !phone || !province || !city || !detail) {
            alert('è¯·å¡«å†™å®Œæ•´çš„åœ°å€ä¿¡æ¯');
            return;
        }

        const newAddress = {
            id: Date.now(),
            name,
            phone,
            province,
            city,
            detail,
            isDefault: addresses.length === 0
        };

        addresses.push(newAddress);
        localStorage.setItem('wuwumall_addresses', JSON.stringify(addresses));

        selectAddress(newAddress.id);
        closeAddressModal();
        renderAddresses();
    }

    // æˆåŠŸé¡µé¢æ“ä½œ
    function viewOrder() {
        window.location.href = 'customer.html?tab=orders';
    }

    function continueShopping() {
        window.location.href = 'index.html';
    }

    // åˆå§‹åŒ–çœä»½åŸå¸‚æ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼‰
    function initRegionData() {
        const provinces = ['åŒ—äº¬å¸‚', 'ä¸Šæµ·å¸‚', 'å¹¿å·å¸‚', 'æ·±åœ³å¸‚', 'æ­å·å¸‚'];
        const cities = {
            'åŒ—äº¬å¸‚': ['åŒ—äº¬å¸‚'],
            'ä¸Šæµ·å¸‚': ['ä¸Šæµ·å¸‚'],
            'å¹¿å·å¸‚': ['å¹¿å·å¸‚'],
            'æ·±åœ³å¸‚': ['æ·±åœ³å¸‚'],
            'æ­å·å¸‚': ['æ­å·å¸‚']
        };

        const provinceSelect = document.getElementById('province');
        provinceSelect.innerHTML = '<option>è¯·é€‰æ‹©çœä»½</option>' +
            provinces.map(p => `<option>${p}</option>`).join('');

        provinceSelect.onchange = function() {
            const citySelect = document.getElementById('city');
            const selectedCities = cities[this.value] || [];
            citySelect.innerHTML = '<option>è¯·é€‰æ‹©åŸå¸‚</option>' +
                selectedCities.map(c => `<option>${c}</option>`).join('');
        };
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åœ°åŒºæ•°æ®
    document.addEventListener('DOMContentLoaded', initRegionData);
</script>
</body>
</html>